[
  {
    "objectID": "P4.html#presentación",
    "href": "P4.html#presentación",
    "title": "4  Fusionado",
    "section": "4.1 Presentación",
    "text": "4.1 Presentación\nAquí dejo la presentación"
  },
  {
    "objectID": "P4.html#fusionado-de-conjuntos-de-datos",
    "href": "P4.html#fusionado-de-conjuntos-de-datos",
    "title": "4  Fusionado",
    "section": "4.2 Fusionado de conjuntos de datos",
    "text": "4.2 Fusionado de conjuntos de datos\nVamos a trabajar con esta base de datos de la ENIGH 2022, que tiene tablas separadas.\n\nif (!require(\"pacman\")) install.packages(\"pacman\") # instala pacman si se requiere\n\nCargando paquete requerido: pacman\n\npacman::p_load(skimr,tidyverse, magrittr, # sobretodo para dplyr\n              haven, readxl, #importación\n              janitor, \n              sjlabelled) \n\nHoy cargamos la versión seccionada de la base\n\nviviendas <- haven::read_sav(\"datos/viviendas.sav\")\nconcentrado <- haven::read_sav(\"datos/concentradohogar.sav\")\npoblacion<- haven::read_sav(\"datos/poblacion.sav\")"
  },
  {
    "objectID": "P4.html#juntando-bases",
    "href": "P4.html#juntando-bases",
    "title": "4  Fusionado",
    "section": "4.3 Juntando bases",
    "text": "4.3 Juntando bases\nMuchas bases de datos están organizadas en varias tablas. La ventaja de la programación por objetos de R, nos permite tener las bases cargadas en nuestro ambiente y llamarlas y juntarlas cuando sea necesario.\n\ndim(viviendas)\n\n[1] 88823    64\n\nnames(viviendas[,1:15])\n\n [1] \"folioviv\"   \"tipo_viv\"   \"mat_pared\"  \"mat_techos\" \"mat_pisos\" \n [6] \"antiguedad\" \"antigua_ne\" \"cocina\"     \"cocina_dor\" \"cuart_dorm\"\n[11] \"num_cuarto\" \"disp_agua\"  \"dotac_agua\" \"excusado\"   \"uso_compar\"\n\ndim(concentrado)\n\n[1] 90102   126\n\nnames(concentrado[,1:15])\n\n [1] \"folioviv\"   \"foliohog\"   \"ubica_geo\"  \"tam_loc\"    \"est_socio\" \n [6] \"est_dis\"    \"upm\"        \"factor\"     \"clase_hog\"  \"sexo_jefe\" \n[11] \"edad_jefe\"  \"educa_jefe\" \"tot_integ\"  \"hombres\"    \"mujeres\"   \n\ndim(poblacion)\n\n[1] 309684    188\n\nnames(poblacion[,1:15])\n\n [1] \"folioviv\"   \"foliohog\"   \"numren\"     \"parentesco\" \"sexo\"      \n [6] \"edad\"       \"madre_hog\"  \"madre_id\"   \"padre_hog\"  \"padre_id\"  \n[11] \"disc_camin\" \"disc_ver\"   \"disc_brazo\" \"disc_apren\" \"disc_oir\"  \n\n\nPara juntar bases usamos el comando merge()\nEn by = ponemos el id, correspondiente a la variable o variables que lo conforman, de manera entrecomillada o de vector. Cuando estamos mezclando bases del mismo nivel de análisis el id es igual en ambas bases. Cuando estamos incorporando información de bases de distinto nivel debemos escoger el nivel mayor.\nEn este caso, sabemos que a una vivienda corresponde más de un hogar (1 a muchos). Esto se puede revisar documentación, sabemos que el id de la tabla viviendas es folioviv\n\nmerge_data<- merge(viviendas, concentrado, by=\"folioviv\")\n\nEsto es equivalente a left_join() de {dplyr}\n\nmerge_data <- dplyr::left_join(viviendas, concentrado, by=\"folioviv\") \n\nmerge_data <- viviendas %>% \n  dplyr::left_join(concentrado, by=\"folioviv\") \n\nRevisemos la base creada\n\nnames(merge_data)\n\n  [1] \"folioviv\"    \"tipo_viv\"    \"mat_pared\"   \"mat_techos\"  \"mat_pisos\"  \n  [6] \"antiguedad\"  \"antigua_ne\"  \"cocina\"      \"cocina_dor\"  \"cuart_dorm\" \n [11] \"num_cuarto\"  \"disp_agua\"   \"dotac_agua\"  \"excusado\"    \"uso_compar\" \n [16] \"sanit_agua\"  \"biodigest\"   \"bano_comp\"   \"bano_excus\"  \"bano_regad\" \n [21] \"drenaje\"     \"disp_elect\"  \"focos_inca\"  \"focos_ahor\"  \"combustible\"\n [26] \"estufa_chi\"  \"eli_basura\"  \"tenencia\"    \"renta\"       \"estim_pago\" \n [31] \"pago_viv\"    \"pago_mesp\"   \"tipo_adqui\"  \"viv_usada\"   \"tipo_finan\" \n [36] \"num_dueno1\"  \"hog_dueno1\"  \"num_dueno2\"  \"hog_dueno2\"  \"escrituras\" \n [41] \"lavadero\"    \"fregadero\"   \"regadera\"    \"tinaco_azo\"  \"cisterna\"   \n [46] \"pileta\"      \"calent_sol\"  \"calent_gas\"  \"medidor_luz\" \"bomba_agua\" \n [51] \"tanque_gas\"  \"aire_acond\"  \"calefacc\"    \"tot_resid\"   \"tot_hom\"    \n [56] \"tot_muj\"     \"tot_hog\"     \"ubica_geo.x\" \"tam_loc.x\"   \"est_socio.x\"\n [61] \"est_dis.x\"   \"upm.x\"       \"factor.x\"    \"procaptar\"   \"foliohog\"   \n [66] \"ubica_geo.y\" \"tam_loc.y\"   \"est_socio.y\" \"est_dis.y\"   \"upm.y\"      \n [71] \"factor.y\"    \"clase_hog\"   \"sexo_jefe\"   \"edad_jefe\"   \"educa_jefe\" \n [76] \"tot_integ\"   \"hombres\"     \"mujeres\"     \"mayores\"     \"menores\"    \n [81] \"p12_64\"      \"p65mas\"      \"ocupados\"    \"percep_ing\"  \"perc_ocupa\" \n [86] \"ing_cor\"     \"ingtrab\"     \"trabajo\"     \"sueldos\"     \"horas_extr\" \n [91] \"comisiones\"  \"aguinaldo\"   \"indemtrab\"   \"otra_rem\"    \"remu_espec\" \n [96] \"negocio\"     \"noagrop\"     \"industria\"   \"comercio\"    \"servicios\"  \n[101] \"agrope\"      \"agricolas\"   \"pecuarios\"   \"reproducc\"   \"pesca\"      \n[106] \"otros_trab\"  \"rentas\"      \"utilidad\"    \"arrenda\"     \"transfer\"   \n[111] \"jubilacion\"  \"becas\"       \"donativos\"   \"remesas\"     \"bene_gob\"   \n[116] \"transf_hog\"  \"trans_inst\"  \"estim_alqu\"  \"otros_ing\"   \"gasto_mon\"  \n[121] \"alimentos\"   \"ali_dentro\"  \"cereales\"    \"carnes\"      \"pescado\"    \n[126] \"leche\"       \"huevo\"       \"aceites\"     \"tuberculo\"   \"verduras\"   \n[131] \"frutas\"      \"azucar\"      \"cafe\"        \"especias\"    \"otros_alim\" \n[136] \"bebidas\"     \"ali_fuera\"   \"tabaco\"      \"vesti_calz\"  \"vestido\"    \n[141] \"calzado\"     \"vivienda\"    \"alquiler\"    \"pred_cons\"   \"agua\"       \n[146] \"energia\"     \"limpieza\"    \"cuidados\"    \"utensilios\"  \"enseres\"    \n[151] \"salud\"       \"atenc_ambu\"  \"hospital\"    \"medicinas\"   \"transporte\" \n[156] \"publico\"     \"foraneo\"     \"adqui_vehi\"  \"mantenim\"    \"refaccion\"  \n[161] \"combus\"      \"comunica\"    \"educa_espa\"  \"educacion\"   \"esparci\"    \n[166] \"paq_turist\"  \"personales\"  \"cuida_pers\"  \"acces_pers\"  \"otros_gas\"  \n[171] \"transf_gas\"  \"percep_tot\"  \"retiro_inv\"  \"prestamos\"   \"otras_perc\" \n[176] \"ero_nm_viv\"  \"ero_nm_hog\"  \"erogac_tot\"  \"cuota_viv\"   \"mater_serv\" \n[181] \"material\"    \"servicio\"    \"deposito\"    \"prest_terc\"  \"pago_tarje\" \n[186] \"deudas\"      \"balance\"     \"otras_erog\"  \"smg\"        \n\ndim(merge_data)\n\n[1] 90102   189\n\n\nAlgunos elementos\n\nEl orden de las variables corresponde al orden que pusimos las bases en las opciones.\nTambién vemos que las variables que se repetían en ambas bases se repiten en la nueva base,con un sufijo .x, para lo que proviene de la primera base y con .y, lo que proviene de la segunda. R dejará las variables intactas y son coincidentes, en nuestro caso, porque las variables son iguales. R hace esto para prever que por error tengamos alguna variable con un nombre igual y no sea la misma en su contenido."
  },
  {
    "objectID": "P4.html#merge-con-id-compuesto",
    "href": "P4.html#merge-con-id-compuesto",
    "title": "4  Fusionado",
    "section": "4.4 Merge con id compuesto",
    "text": "4.4 Merge con id compuesto\nLos identificadores pueden estar compuestos de más de una variable:\n\nViviendas viviendas es folioviv\n\n\nviviendas %>% \n  janitor::get_dupes(folioviv)\n\nNo duplicate combinations found of: folioviv\n\n\n# A tibble: 0 × 65\n# ℹ 65 variables: folioviv <chr>, dupe_count <int>, tipo_viv <chr+lbl>,\n#   mat_pared <chr+lbl>, mat_techos <chr+lbl>, mat_pisos <chr+lbl>,\n#   antiguedad <dbl>, antigua_ne <chr+lbl>, cocina <chr+lbl>,\n#   cocina_dor <chr+lbl>, cuart_dorm <dbl>, num_cuarto <dbl>,\n#   disp_agua <chr+lbl>, dotac_agua <chr+lbl>, excusado <chr+lbl>,\n#   uso_compar <chr+lbl>, sanit_agua <chr+lbl>, biodigest <chr+lbl>,\n#   bano_comp <dbl>, bano_excus <dbl>, bano_regad <dbl>, drenaje <chr+lbl>, …\n\n\n\nconcentrado concentrado es c(\"folioviv\", \"foliohog\")\n\n\nconcentrado %>% \n  janitor::get_dupes(c(folioviv, foliohog))\n\nNo duplicate combinations found of: folioviv, foliohog\n\n\n# A tibble: 0 × 127\n# ℹ 127 variables: folioviv <chr>, foliohog <chr>, dupe_count <int>,\n#   ubica_geo <chr+lbl>, tam_loc <chr+lbl>, est_socio <chr+lbl>, est_dis <chr>,\n#   upm <chr>, factor <dbl>, clase_hog <chr+lbl>, sexo_jefe <chr+lbl>,\n#   edad_jefe <dbl>, educa_jefe <chr+lbl>, tot_integ <dbl>, hombres <dbl>,\n#   mujeres <dbl>, mayores <dbl>, menores <dbl>, p12_64 <dbl>, p65mas <dbl>,\n#   ocupados <dbl>, percep_ing <dbl>, perc_ocupa <dbl>, ing_cor <dbl>,\n#   ingtrab <dbl>, trabajo <dbl>, sueldos <dbl>, horas_extr <dbl>, …\n\n\n\nPoblacion individuos es c(\"folioviv\", \"foliohog\", \"numren\")\n\n\npoblacion %>% \n  janitor::get_dupes(c(folioviv, foliohog, numren))\n\nNo duplicate combinations found of: folioviv, foliohog, numren\n\n\n# A tibble: 0 × 189\n# ℹ 189 variables: folioviv <chr>, foliohog <chr>, numren <chr>,\n#   dupe_count <int>, parentesco <chr+lbl>, sexo <chr+lbl>, edad <dbl>,\n#   madre_hog <chr+lbl>, madre_id <chr>, padre_hog <chr+lbl>, padre_id <chr>,\n#   disc_camin <chr+lbl>, disc_ver <chr+lbl>, disc_brazo <chr+lbl>,\n#   disc_apren <chr+lbl>, disc_oir <chr+lbl>, disc_vest <chr+lbl>,\n#   disc_habla <chr+lbl>, disc_acti <chr+lbl>, cau_camin <chr+lbl>,\n#   cau_ver <chr+lbl>, cau_brazo <chr+lbl>, cau_apren <chr+lbl>, …\n\n\nEsto es un id compuesto. No es una sola variable. Para esto modificamos ligeramente cómo ponemos el by =, pero siempre eligiendo el id de la base de mayor nivel. (Tené cuidado con los paréntesis)\n\nmerge_data2<- merge(concentrado, poblacion, \n                    by = c(\"folioviv\", \"foliohog\"))\ndim(merge_data2)\n\n[1] 309684    312\n\n\nRevisemos la base\n\nmerge_data2 %>% \n  tail()\n\n         folioviv foliohog ubica_geo tam_loc est_socio est_dis.x   upm.x\n309679 3260797909        1     32046       4         2       560 0010232\n309680 3260797910        1     32046       4         2       560 0010232\n309681 3260797910        1     32046       4         2       560 0010232\n309682 3260797912        1     32046       4         2       560 0010232\n309683 3260797912        1     32046       4         2       560 0010232\n309684 3260797912        1     32046       4         2       560 0010232\n       factor.x clase_hog sexo_jefe edad_jefe educa_jefe tot_integ hombres\n309679      123         2         1        37         04         4       2\n309680      123         2         1        63         06         2       1\n309681      123         2         1        63         06         2       1\n309682      123         2         1        29         10         3       1\n309683      123         2         1        29         10         3       1\n309684      123         2         1        29         10         3       1\n       mujeres mayores menores p12_64 p65mas ocupados percep_ing perc_ocupa\n309679       2       2       2      2      0        1          1          1\n309680       1       2       0      2      0        2          1          1\n309681       1       2       0      2      0        2          1          1\n309682       2       2       1      2      0        2          2          2\n309683       2       2       1      2      0        2          2          2\n309684       2       2       1      2      0        2          2          2\n         ing_cor   ingtrab  trabajo  sueldos horas_extr comisiones aguinaldo\n309679  27055.89  26413.04 26413.04 26413.04          0          0         0\n309680 159450.69 136709.99     0.00     0.00          0          0         0\n309681 159450.69 136709.99     0.00     0.00          0          0         0\n309682  43633.12  38739.12     0.00     0.00          0          0         0\n309683  43633.12  38739.12     0.00     0.00          0          0         0\n309684  43633.12  38739.12     0.00     0.00          0          0         0\n       indemtrab otra_rem remu_espec   negocio   noagrop industria comercio\n309679         0        0          0      0.00      0.00         0        0\n309680         0        0          0 136709.99 136709.99         0   136710\n309681         0        0          0 136709.99 136709.99         0   136710\n309682         0        0          0  38739.12  38739.12         0        0\n309683         0        0          0  38739.12  38739.12         0        0\n309684         0        0          0  38739.12  38739.12         0        0\n       servicios agrope agricolas pecuarios reproducc pesca otros_trab rentas\n309679      0.00      0         0         0         0     0          0      0\n309680      0.00      0         0         0         0     0          0      0\n309681      0.00      0         0         0         0     0          0      0\n309682  38739.12      0         0         0         0     0          0      0\n309683  38739.12      0         0         0         0     0          0      0\n309684  38739.12      0         0         0         0     0          0      0\n       utilidad arrenda transfer jubilacion becas donativos remesas bene_gob\n309679        0       0   642.85          0     0         0       0        0\n309680        0       0 14031.03          0     0         0       0        0\n309681        0       0 14031.03          0     0         0       0        0\n309682        0       0  2571.42          0     0         0       0        0\n309683        0       0  2571.42          0     0         0       0        0\n309684        0       0  2571.42          0     0         0       0        0\n       transf_hog trans_inst estim_alqu otros_ing gasto_mon alimentos\n309679     642.85          0       0.00         0  18702.34   6325.68\n309680   14031.03          0    8709.67         0 117455.55  59322.63\n309681   14031.03          0    8709.67         0 117455.55  59322.63\n309682    2571.42          0    2322.58         0  30166.09  13512.73\n309683    2571.42          0    2322.58         0  30166.09  13512.73\n309684    2571.42          0    2322.58         0  30166.09  13512.73\n       ali_dentro cereales  carnes pescado   leche   huevo aceites tuberculo\n309679    4204.26  1157.13 2057.14       0  989.99    0.00       0      0.00\n309680   51608.35 10697.09    0.00       0 2854.27 1028.56       0   2288.56\n309681   51608.35 10697.09    0.00       0 2854.27 1028.56       0   2288.56\n309682   11905.59  1414.26 1864.28       0 2455.69  321.42       0    488.57\n309683   11905.59  1414.26 1864.28       0 2455.69  321.42       0    488.57\n309684   11905.59  1414.26 1864.28       0 2455.69  321.42       0    488.57\n       verduras  frutas azucar    cafe especias otros_alim bebidas ali_fuera\n309679     0.00    0.00      0    0.00     0.00       0.00    0.00   2121.42\n309680  4847.08 1157.11      0 7328.57 13139.99    6377.13 1889.99   7714.28\n309681  4847.08 1157.11      0 7328.57 13139.99    6377.13 1889.99   7714.28\n309682  2121.39 1028.57      0    0.00     0.00    2211.41    0.00   1607.14\n309683  2121.39 1028.57      0    0.00     0.00    2211.41    0.00   1607.14\n309684  2121.39 1028.57      0    0.00     0.00    2211.41    0.00   1607.14\n       tabaco vesti_calz vestido calzado vivienda alquiler pred_cons  agua\n309679      0    1036.95    0.00 1036.95  4385.37  2322.58         0 181.5\n309680      0       0.00    0.00    0.00   501.00     0.00       100 200.0\n309681      0       0.00    0.00    0.00   501.00     0.00       100 200.0\n309682      0     273.91  273.91    0.00   410.00     0.00        50   0.0\n309683      0     273.91  273.91    0.00   410.00     0.00        50   0.0\n309684      0     273.91  273.91    0.00   410.00     0.00        50   0.0\n       energia limpieza cuidados utensilios enseres  salud atenc_ambu hospital\n309679 1881.29  3028.03  3028.03          0     0.0    0.0        0.0        0\n309680  201.00  5530.63  5530.63          0     0.0  782.6      782.6        0\n309681  201.00  5530.63  5530.63          0     0.0  782.6      782.6        0\n309682  360.00  1186.77   795.47          0   391.3 1956.5     1956.5        0\n309683  360.00  1186.77   795.47          0   391.3 1956.5     1956.5        0\n309684  360.00  1186.77   795.47          0   391.3 1956.5     1956.5        0\n       medicinas transporte publico foraneo adqui_vehi mantenim refaccion\n309679         0    2283.13       0       0          0  2283.13    831.52\n309680         0   16259.12       0       0          0 14516.12      0.00\n309681         0   16259.12       0       0          0 14516.12      0.00\n309682         0    4383.87       0       0          0  3483.87      0.00\n309683         0    4383.87       0       0          0  3483.87      0.00\n309684         0    4383.87       0       0          0  3483.87      0.00\n         combus comunica educa_espa educacion esparci paq_turist personales\n309679  1451.61        0       0.00         0    0.00          0    1643.18\n309680 14516.12     1743       0.00         0    0.00          0     435.48\n309681 14516.12     1743       0.00         0    0.00          0     435.48\n309682  3483.87      900    3913.04         0 3913.04          0    4529.27\n309683  3483.87      900    3913.04         0 3913.04          0    4529.27\n309684  3483.87      900    3913.04         0 3913.04          0    4529.27\n       cuida_pers acces_pers otros_gas transf_gas percep_tot retiro_inv\n309679    1643.18       0.00         0       0.00          0          0\n309680     435.48       0.00         0   34624.09          0          0\n309681     435.48       0.00         0   34624.09          0          0\n309682    3794.49     234.78       500       0.00          0          0\n309683    3794.49     234.78       500       0.00          0          0\n309684    3794.49     234.78       500       0.00          0          0\n       prestamos otras_perc ero_nm_viv ero_nm_hog erogac_tot cuota_viv\n309679         0          0          0          0       0.00         0\n309680         0          0          0          0   58451.08         0\n309681         0          0          0          0   58451.08         0\n309682         0          0          0          0    9538.04         0\n309683         0          0          0          0    9538.04         0\n309684         0          0          0          0    9538.04         0\n       mater_serv material servicio deposito prest_terc pago_tarje deudas\n309679          0        0        0     0.00          0          0      0\n309680          0        0        0 58451.08          0          0      0\n309681          0        0        0 58451.08          0          0      0\n309682          0        0        0  9538.04          0          0      0\n309683          0        0        0  9538.04          0          0      0\n309684          0        0        0  9538.04          0          0      0\n       balance otras_erog     smg numren parentesco sexo edad madre_hog\n309679       0          0 15558.3     04        301    1    5         1\n309680       0          0 15558.3     01        101    1   63         2\n309681       0          0 15558.3     02        201    2   59         2\n309682       0          0 15558.3     01        101    1   29         2\n309683       0          0 15558.3     02        201    2   30         2\n309684       0          0 15558.3     03        301    2    0         1\n       madre_id padre_hog padre_id disc_camin disc_ver disc_brazo disc_apren\n309679       02         1       01          4        4          4          4\n309680                  2                   4        3          4          4\n309681                  2                   4        3          4          4\n309682                  2                   4        4          4          4\n309683                  2                   4        4          4          4\n309684       02         1       01          4        4          4          4\n       disc_oir disc_vest disc_habla disc_acti cau_camin cau_ver cau_brazo\n309679        4         4          4         4                            \n309680        4         4          4         4                 2          \n309681        4         4          4         4                 2          \n309682        4         4          4         4                            \n309683        4         4          4         4                            \n309684        4         4          4         4                            \n       cau_apren cau_oir cau_vest cau_habla cau_acti hablaind lenguaind\n309679                                                      2          \n309680                                                      2          \n309681                                                      2          \n309682                                                      2          \n309683                                                      2          \n309684                                                                 \n       hablaesp comprenind etnia alfabetism asis_esc nivel grado tipoesc\n309679                   2     2          2        1    01     3       1\n309680                   2     2          1        2                    \n309681                   2     2          1        2                    \n309682                   2     2          1        2                    \n309683                   2     2          1        2                    \n309684                                                                  \n       tiene_b otorg_b forma_b tiene_c otorg_c forma_c nivelaprob gradoaprob\n309679       2                                                  1          2\n309680                                                          3          3\n309681                                                          3          3\n309682                                                          7          5\n309683                                                          7          5\n309684                                                                      \n       antec_esc residencia edo_conyug pareja_hog conyuge_id segsoc ss_aa ss_mm\n309679                   32                                            NA    NA\n309680                   32          2          1         02      2    NA    NA\n309681                   32          2          1         01      2    NA    NA\n309682         3         32          2          1         02      2    NA    NA\n309683         3         32          2          1         01      2    NA    NA\n309684                                                                 NA    NA\n       redsoc_1 redsoc_2 redsoc_3 redsoc_4 redsoc_5 redsoc_6 hor_1 min_1\n309679                                                          NA    NA\n309680        2        3        3        3        3             56     0\n309681                                                          NA    NA\n309682        3        3        3        3        2        3    48     0\n309683        3        2        3        4        2        2    10     0\n309684                                                          NA    NA\n       usotiempo1 hor_2 min_2 usotiempo2 hor_3 min_3 usotiempo3 hor_4 min_4\n309679               NA    NA               NA    NA               NA    NA\n309680               NA    NA          9    NA    NA          9    NA    NA\n309681               NA    NA               NA    NA               NA    NA\n309682               NA    NA          9    NA    NA          9    NA    NA\n309683               NA    NA          9    NA    NA          9    NA    NA\n309684               NA    NA               NA    NA               NA    NA\n       usotiempo4 hor_5 min_5 usotiempo5 hor_6 min_6 usotiempo6 hor_7 min_7\n309679               NA    NA               NA    NA               NA    NA\n309680          9    NA    NA          9    NA    NA          9    NA    NA\n309681               NA    NA               NA    NA               NA    NA\n309682          9     2     0               NA    NA          9    NA    NA\n309683          9    NA    NA          9    10     0               NA    NA\n309684               NA    NA               NA    NA               NA    NA\n       usotiempo7 hor_8 min_8 usotiempo8 pop_insabi atemed inst_1 inst_2 inst_3\n309679               NA    NA                     2      2                     \n309680          9    21     0                     2      2                     \n309681               NA    NA                     2      2                     \n309682          9    21     0                     2      2                     \n309683          9    10     0                     2      2                     \n309684               NA    NA                     2      2                     \n       inst_4 inst_5 inst_6 inscr_1 inscr_2 inscr_3 inscr_4 inscr_5 inscr_6\n309679                                                                     \n309680                                                                     \n309681                                                                     \n309682                                                                     \n309683                                                                     \n309684                                                                     \n       inscr_7 inscr_8 prob_anio prob_mes prob_sal aten_sal servmed_1 servmed_2\n309679                      2022       06        1        1                    \n309680                      2022       10        1        1                    \n309681                      2018       03        1        1                    \n309682                      2022       09        1        1                    \n309683                      2022       06        1        1                    \n309684                      2022       07        1        1                    \n       servmed_3 servmed_4 servmed_5 servmed_6 servmed_7 servmed_8 servmed_9\n309679                                                          08          \n309680                                                          08          \n309681                                                          08          \n309682                                                          08          \n309683                                                          08          \n309684                                                          08          \n       servmed_10 servmed_11 servmed_12 hh_lug mm_lug hh_esp mm_esp pagoaten_1\n309679                                       0     10      0     10          1\n309680                                       1      0      0      1           \n309681                                       0     30      1      0           \n309682                                       0      5      0     10          1\n309683                                       0     22      0      5          1\n309684                                       5      0      0      5          1\n       pagoaten_2 pagoaten_3 pagoaten_4 pagoaten_5 pagoaten_6 pagoaten_7\n309679          2                                                       \n309680                                                                 7\n309681                                                      6           \n309682          2                                                       \n309683          2                                                       \n309684          2                                                       \n       noatenc_1 noatenc_2 noatenc_3 noatenc_4 noatenc_5 noatenc_6 noatenc_7\n309679                                                                      \n309680                                                                      \n309681                                                                      \n309682                                                                      \n309683                                                                      \n309684                                                                      \n       noatenc_8 noatenc_9 noatenc_10 noatenc_11 noatenc_12 noatenc_13\n309679                                                                \n309680                                                                \n309681                                                                \n309682                                                                \n309683                                                                \n309684                                                                \n       noatenc_14 noatenc_15 noatenc_16 norecib_1 norecib_2 norecib_3 norecib_4\n309679                                                                         \n309680                                                                         \n309681                                                                         \n309682                                                                         \n309683                                                                         \n309684                                                                         \n       norecib_5 norecib_6 norecib_7 norecib_8 norecib_9 norecib_10 norecib_11\n309679                                                                        \n309680                                                                        \n309681                                                                        \n309682                                                                        \n309683                                                                        \n309684                                                                        \n       norecib_12 razon_1 razon_2 razon_3 razon_4 razon_5 razon_6 razon_7\n309679                                                                   \n309680                                                                   \n309681                                                                   \n309682                                                                   \n309683                                                                   \n309684                                                                   \n       razon_8 razon_9 razon_10 razon_11 diabetes pres_alta peso segvol_1\n309679                                                         1         \n309680                                          1         1    1         \n309681                                          1         1    1         \n309682                                          2         1    1         \n309683                                          2         1    1         \n309684                                                         1         \n       segvol_2 segvol_3 segvol_4 segvol_5 segvol_6 segvol_7 hijos_viv\n309679                                                              NA\n309680                                            6                 NA\n309681                                            6                  4\n309682                                            6                 NA\n309683                                            6                  1\n309684                                                              NA\n       hijos_mue hijos_sob trabajo_mp motivo_aus act_pnea1 act_pnea2 num_trabaj\n309679        NA        NA                                                     \n309680        NA        NA          1                                         1\n309681         0         4          1                                         1\n309682        NA        NA          1                                         1\n309683         0         1          1                                         1\n309684        NA        NA                                                     \n       c_futuro ct_futuro entidad est_dis.y   upm.y factor.y\n309679                         32       560 0010232      123\n309680                         32       560 0010232      123\n309681                         32       560 0010232      123\n309682                         32       560 0010232      123\n309683                         32       560 0010232      123\n309684                         32       560 0010232      123"
  },
  {
    "objectID": "P4.html#bases-de-distinto-tamaño",
    "href": "P4.html#bases-de-distinto-tamaño",
    "title": "4  Fusionado",
    "section": "4.5 Bases de distinto tamaño",
    "text": "4.5 Bases de distinto tamaño\nHasta ahorita hemos hecho merge que son de unidades de distinto nivel y son incluyentes. A veces tenemos bases de datos que son de distinto tamaño y del mismo nivel. A veces las dos aportan casos y a veces aportan variables, y a veces, las dos aportan las dos cosas.\nVamos a revisar qué pasaría si quisiéramos incorporar la información los ingresos\n\nrm(merge_data, merge_data2) # botamos otros ejemplos\n\ningresos<- haven::read_sav(\"datos/ingresos.sav\")\n\nEsta base tiene otro ID\n\nIngresos ingresos es c(\"folioviv\", \"foliohog\", \"numren\", \"clave\")\n\n\ningresos %>% \n  janitor::get_dupes(c(folioviv, foliohog, numren, clave))\n\nNo duplicate combinations found of: folioviv, foliohog, numren, clave\n\n\n# A tibble: 0 × 22\n# ℹ 22 variables: folioviv <chr>, foliohog <chr>, numren <chr>,\n#   clave <chr+lbl>, dupe_count <int>, mes_1 <chr+lbl>, mes_2 <chr+lbl>,\n#   mes_3 <chr+lbl>, mes_4 <chr+lbl>, mes_5 <chr+lbl>, mes_6 <chr+lbl>,\n#   ing_1 <dbl>, ing_2 <dbl>, ing_3 <dbl>, ing_4 <dbl>, ing_5 <dbl>,\n#   ing_6 <dbl>, ing_tri <dbl>, entidad <chr+lbl>, est_dis <chr>, upm <chr>,\n#   factor <dbl>\n\n\n¿Cuántas claves de ingreso hay?\n\ningresos %>% \n  tabyl(clave)\n\n clave      n      percent\n  P001 105685 2.660871e-01\n  P002   2277 5.732888e-03\n  P003   7733 1.946966e-02\n  P004   7706 1.940168e-02\n  P005   3325 8.371477e-03\n  P006   8056 2.028289e-02\n  P007   6676 1.680842e-02\n  P008  18475 4.651520e-02\n  P009  50726 1.277148e-01\n  P011    371 9.340806e-04\n  P012   3296 8.298463e-03\n  P013      3 7.553212e-06\n  P014   4752 1.196429e-02\n  P015     47 1.183337e-04\n  P016    676 1.701991e-03\n  P018     11 2.769511e-05\n  P019    297 7.477680e-04\n  P020      1 2.517737e-06\n  P021   1477 3.718698e-03\n  P022  15569 3.919865e-02\n  P023    775 1.951247e-03\n  P024   2563 6.452961e-03\n  P025    194 4.884411e-04\n  P026    273 6.873423e-04\n  P027    240 6.042570e-04\n  P028    100 2.517737e-04\n  P029     13 3.273059e-05\n  P030      3 7.553212e-06\n  P031    142 3.575187e-04\n  P032  17420 4.385899e-02\n  P033    828 2.084687e-03\n  P034     38 9.567402e-05\n  P035    178 4.481573e-04\n  P036    912 2.296177e-03\n  P037    465 1.170748e-03\n  P038   3080 7.754631e-03\n  P039    473 1.190890e-03\n  P040  22391 5.637466e-02\n  P041   6290 1.583657e-02\n  P043   1612 4.058593e-03\n  P045    650 1.636529e-03\n  P048    793 1.996566e-03\n  P049   1732 4.360721e-03\n  P050     35 8.812081e-05\n  P051  11024 2.775554e-02\n  P052    860 2.165254e-03\n  P053   4842 1.219088e-02\n  P054    216 5.438313e-04\n  P055     10 2.517737e-05\n  P056      1 2.517737e-06\n  P057     87 2.190432e-04\n  P058    366 9.214919e-04\n  P059     64 1.611352e-04\n  P060    140 3.524832e-04\n  P061    209 5.262071e-04\n  P062    806 2.029296e-03\n  P063   2717 6.840693e-03\n  P064     23 5.790796e-05\n  P065     77 1.938658e-04\n  P066    223 5.614555e-04\n  P067   1761 4.433736e-03\n  P068   4882 1.229159e-02\n  P069   6976 1.756374e-02\n  P070   8075 2.033073e-02\n  P071   5079 1.278759e-02\n  P072   4113 1.035545e-02\n  P073    185 4.657814e-04\n  P074    198 4.985120e-04\n  P075    735 1.850537e-03\n  P076   1136 2.860150e-03\n  P077   1472 3.706110e-03\n  P078   1459 3.673379e-03\n  P079   1260 3.172349e-03\n  P080    105 2.643624e-04\n  P081     49 1.233691e-04\n  P101   7943 1.999839e-02\n  P102   5346 1.345982e-02\n  P103    647 1.628976e-03\n  P104  22933 5.773927e-02\n  P105   2036 5.126113e-03\n  P106    329 8.283356e-04\n  P107     66 1.661707e-04\n  P108    373 9.391161e-04\n\n\n\ningresos_sueldos<-ingresos %>% \n    filter(clave==\"P001\") \ndim(ingresos_sueldos)\n\n[1] 105685     21\n\n\nVamos a hacer el primer tipo de fusionado\n\nmerge_data3<-merge(poblacion, ingresos_sueldos, by=c(\"folioviv\", \"foliohog\", \"numren\"))\ndim(merge_data3)\n\n[1] 105685    206\n\n\n¡La base nueva no tiene a todas las observaciones, solo la que tiene en la base más pequeña!"
  },
  {
    "objectID": "P4.html#cuatro-formas-de-hacer-un-fusionado",
    "href": "P4.html#cuatro-formas-de-hacer-un-fusionado",
    "title": "4  Fusionado",
    "section": "4.6 Cuatro formas de hacer un fusionado",
    "text": "4.6 Cuatro formas de hacer un fusionado\nEn realidad hay cuatro formas de hacer un “merge”\n\n4.6.1 Casos en ambas bases\nPor default, el comando tiene activado la opción “all = FALSE”, que nos deja los datos de ambas bases comunes. (tipo una intersección)\n\nmerge_data3<-merge(poblacion, \n                   ingresos_sueldos,\n                   by=c(\"folioviv\", \"foliohog\", \"numren\"), \n                   all = F)\ndim(merge_data3)\n\n[1] 105685    206\n\n\n\n\n4.6.2 Todos los casos\nSi cambiamos la opción “all = TRUE”, que nos deja los datos comunes a ambas bases. (como una unión)\n\nmerge_data3<-merge(poblacion,\n                   ingresos_sueldos, \n                   by=c(\"folioviv\", \"foliohog\", \"numren\"), \n                   all = T)\ndim(merge_data3)\n\n[1] 309684    206\n\n\n\n\n4.6.3 Casos en la base 1\nSi queremos quedarnos con todos los datos que hay en la primera base, x, vamos a usar a opción all.x = TRUE.\n\nmerge_data3<-merge(poblacion, \n                   ingresos_sueldos,\n                   by=c(\"folioviv\", \"foliohog\", \"numren\"), \n                   all.x  = TRUE)\ndim(merge_data3)\n\n[1] 309684    206\n\n\n\n\n4.6.4 Casos de la base 2\nNotamos que hoy sí tenemos los datos de toda la población y hay missings en las variables aportadas por la base de trabajo\nSi queremos lo contrario, quedarnos con los datos aportados por la segunda base, y, vamos a usar la opción all.y=TRUE\n\nmerge_data3<-merge(poblacion, \n                   ingresos_sueldos,\n                   by=c(\"folioviv\", \"foliohog\", \"numren\"),\n                   all.y  = TRUE)\ndim(merge_data3)\n\n[1] 105685    206"
  },
  {
    "objectID": "P4.html#las-cuatro-formas-en-dplyr",
    "href": "P4.html#las-cuatro-formas-en-dplyr",
    "title": "4  Fusionado",
    "section": "4.7 Las cuatro formas en dplyr",
    "text": "4.7 Las cuatro formas en dplyr\nEl caso 1:\n\nmerge_data3<-dplyr::inner_join(poblacion,\n                               ingresos_sueldos,\n                               by=c(\"folioviv\", \"foliohog\", \"numren\"))\ndim(merge_data3)\n\n[1] 105685    206\n\n\nEl caso 2:\n\nmerge_data3<-dplyr::full_join(poblacion, \n                              ingresos_sueldos, \n                              by=c(\"folioviv\", \"foliohog\", \"numren\"))\ndim(merge_data3)\n\n[1] 309684    206\n\n\nEl caso 3:\n\nmerge_data3<-dplyr::left_join(poblacion,\n                              ingresos_sueldos, \n                              by=c(\"folioviv\", \"foliohog\", \"numren\"))\ndim(merge_data3)\n\n[1] 309684    206\n\n\nEl caso 4:\n\nmerge_data3<-dplyr::right_join(poblacion, \n                               ingresos_sueldos,\n                               by=c(\"folioviv\", \"foliohog\", \"numren\"))\ndim(merge_data3)\n\n[1] 105685    206\n\n\nTambién se puede usar con pipes, cualquier opción de dplyr\n\nmerge_data3<-poblacion %>% # pongo el conjunto que será la \"izquierda\n  dplyr::right_join(ingresos_sueldos, \n                    by=c(\"folioviv\", \"foliohog\", \"numren\"))\ndim(merge_data3)\n\n[1] 105685    206"
  },
  {
    "objectID": "P4.html#cheatsheet-de-dplyr",
    "href": "P4.html#cheatsheet-de-dplyr",
    "title": "4  Fusionado",
    "section": "4.8 Cheatsheet de {dplyr}",
    "text": "4.8 Cheatsheet de {dplyr}\nLa puedes descargar de aquí"
  },
  {
    "objectID": "P4.html#ejercicio",
    "href": "P4.html#ejercicio",
    "title": "4  Fusionado",
    "section": "4.9 Ejercicio",
    "text": "4.9 Ejercicio\n¡Junta tu base!"
  }
]